---
sidebar_position: 5
description: Step-by-step guide for modifying URDF files safely
---

# Safely Modifying URDF Files

## Learning Objectives
- Follow a systematic approach to modify URDF files without breaking the robot structure
- Understand the impact of changes to different URDF elements
- Apply best practices for safe URDF modifications
- Validate URDF files after making changes
- Troubleshoot common issues that arise from modifications

## Safe Modification Workflow

### Step 1: Backup Your Original File
Before making any changes, always create a backup:

```bash
cp original_robot.urdf original_robot.urdf.backup
```

Or in your Docusaurus project:
- Copy the MDX file you're modifying to a backup version
- Use version control (git) to track changes

### Step 2: Understand the Current Structure
Before modifying, ensure you understand:
- The kinematic chain and parent-child relationships
- Joint constraints and movement ranges
- Physical properties and their impact on simulation

### Step 3: Make Incremental Changes
- Change one element at a time
- Test after each change
- Document what each change accomplishes

### Step 4: Validate Your Changes
Use URDF validation tools or simulation to verify the robot still works correctly.

## Common Modification Types and How to Approach Them

### 1. Changing Visual Properties

**What to modify:** The `<visual>` section of a link

**Safe approach:**
```xml
<link name="arm_link">
  <visual>
    <!-- Original -->
    <geometry>
      <cylinder radius="0.04" length="0.3"/>
    </geometry>
    <material name="grey">
      <color rgba="0.5 0.5 0.5 1.0"/>
    </material>

    <!-- Safe modification: Change color only -->
    <material name="blue">
      <color rgba="0.0 0.0 1.0 1.0"/>  <!-- Changed to blue -->
    </material>

    <!-- Safe modification: Change shape -->
    <geometry>
      <box size="0.08 0.08 0.3"/>     <!-- Changed from cylinder to box -->
    </geometry>
  </visual>
</link>
```

**Important considerations:**
- Visual changes don't affect physics simulation
- Color changes are always safe
- Shape changes may affect visualization but not kinematics

### 2. Adjusting Joint Limits

**What to modify:** The `<limit>` element within a joint

**Safe approach:**
```xml
<joint name="elbow_joint" type="revolute">
  <parent link="upper_arm"/>
  <child link="forearm"/>
  <axis xyz="1 0 0"/>

  <!-- Original limits -->
  <limit lower="-1.57" upper="1.57" effort="20" velocity="2"/>

  <!-- Safe modification: Widen the range -->
  <limit lower="-2.0" upper="2.0" effort="20" velocity="2"/>  <!-- Increased from ±90° to ±115° -->
</joint>
```

**Important considerations:**
- Never set limits that exceed physical capabilities
- Consider the impact on controllers
- Ensure lower < upper for revolute joints
- Be cautious with effort and velocity limits

### 3. Moving Joint Positions

**What to modify:** The `<origin>` element within a joint

**Safe approach:**
```xml
<joint name="shoulder_joint" type="revolute">
  <parent link="torso"/>
  <child link="upper_arm"/>

  <!-- Original position -->
  <origin xyz="0.2 0 0.4" rpy="0 0 0"/>

  <!-- Safe modification: Move the joint slightly -->
  <origin xyz="0.22 0 0.4" rpy="0 0 0"/>  <!-- Moved 2cm outward -->
</joint>
```

**Important considerations:**
- Ensure the new position makes physical sense
- Verify it doesn't cause collisions with other parts
- Consider the impact on the entire kinematic chain
- XYZ values are in meters

### 4. Adding New Links and Joints

**Safe approach:**
```xml
<!-- Add the new link -->
<link name="new_sensor_mount">
  <visual>
    <geometry>
      <box size="0.02 0.02 0.01"/>
    </geometry>
    <material name="black">
      <color rgba="0 0 0 1"/>
    </material>
  </visual>
  <inertial>
    <mass value="0.1"/>
    <inertia ixx="0.0001" ixy="0" ixz="0" iyy="0.0001" iyz="0" izz="0.0001"/>
  </inertial>
</link>

<!-- Connect it to existing structure -->
<joint name="torso_to_sensor_mount" type="fixed">
  <parent link="torso"/>
  <child link="new_sensor_mount"/>
  <origin xyz="0 0 0.6"/>  <!-- Position on top of torso -->
</joint>
```

**Important considerations:**
- Always add both link and joint definitions
- Use realistic mass values (even for small parts)
- Ensure the new part connects properly to existing structure
- Consider the impact on the robot's center of mass

## Best Practices for Safe Modifications

### 1. Use Consistent Units
- All measurements should be in meters
- Mass in kilograms
- Angles in radians (not degrees)
- Time in seconds

### 2. Maintain Physical Plausibility
```xml
<!-- Good: Realistic mass for a robot arm -->
<inertial>
  <mass value="1.5"/>
  <inertia ixx="0.02" ixy="0.0" ixz="0.0" iyy="0.02" iyz="0.0" izz="0.002"/>
</inertial>

<!-- Bad: Unphysical inertia values -->
<inertial>
  <mass value="1.5"/>
  <inertia ixx="0.0" ixy="0.0" ixz="0.0" iyy="0.0" iyz="0.0" izz="0.0"/>  <!-- Zero inertia is unphysical -->
</inertial>
```

### 3. Preserve Joint Hierarchy
- Don't break the kinematic chain
- Ensure every link (except the base) has exactly one parent
- Verify that the tree structure remains intact

### 4. Test with Simulation
After modifications, test in a simulation environment:
- Check for proper visualization
- Verify physics behavior
- Confirm controllers can handle the new structure

## Common Modification Mistakes and How to Avoid Them

### Mistake 1: Invalid Joint Limits
```xml
<!-- Wrong: Lower limit higher than upper limit -->
<limit lower="2.0" upper="1.0" effort="20" velocity="2"/>

<!-- Correct -->
<limit lower="-1.0" upper="1.0" effort="20" velocity="2"/>
```

### Mistake 2: Missing Inertial Properties
```xml
<!-- Wrong: Link without inertial properties will cause simulation errors -->
<link name="sensor">
  <visual>
    <geometry><box size="0.01 0.01 0.01"/>
  </visual>
  <!-- Missing inertial element -->
</link>

<!-- Correct -->
<link name="sensor">
  <visual>
    <geometry><box size="0.01 0.01 0.01"/>
  </geometry>
  </visual>
  <inertial>
    <mass value="0.01"/>
    <inertia ixx="0.000001" ixy="0" ixz="0" iyy="0.000001" iyz="0" izz="0.000001"/>
  </inertial>
</link>
```

### Mistake 3: Disconnected Links
```xml
<!-- Wrong: Link defined but not connected to the structure -->
<link name="orphan_link">
  <!-- This link exists but isn't connected to anything -->
</link>

<!-- Correct: Every link (except base) should be connected via a joint -->
<joint name="connection_joint" type="fixed">
  <parent link="existing_link"/>
  <child link="new_link"/>
  <origin xyz="0 0 0"/>
</joint>
```

## Validation After Modifications

### 1. Syntax Validation
- Ensure all XML tags are properly closed
- Check for proper nesting
- Verify attribute values are valid

### 2. Structural Validation
- Confirm the robot forms a valid tree structure
- Check that there are no unconnected links
- Verify joint parent-child relationships

### 3. Physical Validation
- Ensure mass values are positive
- Check that inertia values follow physical laws
- Verify joint limits are physically achievable

## Tools for Safe Modification

### 1. Text Editor with XML Support
- Use editors that highlight XML syntax
- Enable automatic tag closing
- Use consistent indentation

### 2. URDF Validators
- Use ROS tools like `check_urdf` to validate structure
- Use visualization tools to confirm the robot looks correct

### 3. Simulation Testing
- Test modifications in Gazebo or similar simulators
- Verify controllers can still function with the modified robot

## Independent Validation

After completing this section, you should be able to:
1. Make safe modifications to URDF files following the step-by-step workflow
2. Understand the impact of different types of changes
3. Avoid common modification mistakes
4. Validate your modifications to ensure they work correctly

## Practice Exercise

Try modifying the following URDF to make the arm longer:
```xml
<link name="upper_arm">
  <visual>
    <origin xyz="0 0 -0.15"/>
    <geometry>
      <cylinder radius="0.04" length="0.3"/>
    </geometry>
  </visual>
  <inertial>
    <mass value="1.5"/>
    <inertia ixx="0.02" ixy="0.0" ixz="0.0" iyy="0.02" iyz="0.0" izz="0.002"/>
  </inertial>
</link>

<joint name="shoulder_to_arm" type="revolute">
  <parent link="shoulder"/>
  <child link="upper_arm"/>
  <origin xyz="0 0 -0.05"/>
  <axis xyz="1 0 0"/>
  <limit lower="-1.57" upper="1.57" effort="20" velocity="2"/>
</joint>
```

**Safe modification approach:**
1. Increase the cylinder length from 0.3 to 0.4
2. Adjust the origin xyz to maintain proper positioning
3. Update the inertial properties to reflect the new dimensions
4. Test that the joint limits still make sense with the longer arm

Answer: The modified version would have increased length, adjusted origin, and updated inertial properties to match the new physical dimensions.